#include "csv.h"
#include <fstream>
#include <sstream>
#include <iostream>

std::vector<Process> readCSV(const std::string& filename) {
    std::vector<Process> list;
    std::ifstream file(filename);

    if (!file.is_open()) {
        std::cout << "Khong mo duoc file CSV\n";
        return list;
    }

    std::string line;
    while (getline(file, line)) {
        if (line.find(',') == std::string::npos) continue;

        std::stringstream ss(line);
        std::string process, arrival, burst;

        getline(ss, process, ',');
        getline(ss, arrival, ',');
        getline(ss, burst, ',');

        try {
            Process p;
            p.process = process;
            p.arrival = std::stoi(arrival);
            p.burst = std::stoi(burst);
            list.push_back(p);
        }
        catch (...) {
            // bo dong loi
        }
    }

    file.close();
    return list;
}

bool validateCSV(const std::vector<Process>& list) {
    if (list.empty()) return false;
    for (auto& p : list) {
        if (p.process.empty()) return false;
        if (p.arrival < 0) return false;
        if (p.burst <= 0) return false;
    }
    return true;
}

void writeCSV(const std::string& filename,
    const std::vector<Process>& list) {
    std::ofstream file(filename);
    for (auto& p : list) {
        file << p.process << ","
            << p.arrival << ","
            << p.burst << "\n";
    }
    file.close();
}

